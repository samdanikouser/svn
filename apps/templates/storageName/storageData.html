{% extends "layouts/base.html" %}
{% load static %}

{% block title %}{{name}}{% endblock %}
{% block stylesheets %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% endblock stylesheets %}

{% block content %}
<!-- Message Section -->
{% if messages %}
    <div class="messages" style="margin-bottom: 20px;">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} message" id="message-{{ forloop.counter }}" style="border-radius: 10px; padding: 20px; font-size: 16px;">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Back Button Section -->
<div style="display: flex; justify-content: space-between; padding: 20px;">
    <a href="javascript:history.back()" class="btn btn-outline-primary btn-lg" style="text-decoration: none; font-size: 18px; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">Back</a>
</div>

<!-- Main Content Section -->
<div class="row">
    <div class="col-lg-12">
        <div class="card shadow-lg rounded" style="border-radius: 12px; background-color: #ffffff;">
            <div class="card-header card-header-primary">
                <h4 class="card-title" style="font-weight: 600; font-size: 24px; letter-spacing: 0.5px;">{{name}} - {{status}}</h4>
            </div>
            <div class="card-body" style="padding: 30px;">
                <h6 class="card-category" style="font-size: 18px; font-weight: 600; margin-bottom: 20px;">
                    <b>Add Task Details</b>
                </h6>
                <form action="{% url 'storage_data_admin_data' name status %}" method="POST">
                    {% csrf_token %}
                    <!-- Task Name Input -->
                    <div class="form-group">
                        <input type="text" class="form-control" id="taskName" name="taskName" placeholder="Enter Task Name" style="border-radius: 8px; padding: 12px 18px; font-size: 16px;">
                    </div>

                    <!-- Used For Section -->
                    <div class="space-related-in border-radius-lg shadow" style="padding: 20px; margin-bottom: 20px;">
                        <h5 class="mt-5" style="font-family: Monospace; text-align: center; color: #007bff;">Used For</h5>
                        <div class="row" style="padding: 10px;">
                            <div class="col">
                                <div class="form-group">
                                    <input type="text" id="used_for" name="used_for" placeholder="Enter Common name" class="form-control" style="border-radius: 8px; padding: 12px 18px;">
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="numberofusedfor" style="font-weight: 600;">Number of Used For:</label>
                                    <input type="number" id="numberofusedfor" name="no_of_used_for" class="form-control" oninput="generateOnField()" style="border-radius: 8px; padding: 12px 18px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Details Section -->
                    <div class="space-related-in border-radius-lg shadow" style="padding: 20px; margin-bottom: 20px;">
                        <h5 class="mt-5" style="font-family: Monospace; text-align: center; color: #007bff;">Task Details</h5>
                        <div class="row" style="padding: 10px;">
                            <div class="col">
                                <div class="form-group">
                                    <label for="assign_task_to" style="font-weight: 600;">Assign Task To:</label>
                                    <select name="assign_task_to" class="form-control" id="assign_task_to" style="border-radius: 8px; padding: 12px 18px;">
                                        <option value="line_staff">Line Staff</option>
                                        <option value="supervisors">Supervisors</option>
                                        <option value="managers">Managers</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col custom_fields">
                                <div class="row" style="padding: 10px;">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="numberInput" style="font-weight: 600;">Repeat Every:</label>
                                            <input type="number" id="numberInput" name="period" class="form-control" oninput="generateOnField()" style="border-radius: 8px; padding: 12px 18px;">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <label for="repeat_frequency" style="font-weight: 600;">Repeat Frequency:</label>
                                        <select name="repeat_frequency" class="form-control" id="repeat_frequency" style="border-radius: 8px; padding: 12px 18px;">
                                            <option value="times_a_day">Times a day</option>
                                            <option value="days">Days</option>
                                            <option value="weeks">Weeks</option>
                                            <option value="months">Months</option>
                                            <option value="years">Years</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="padding: 10px;">
                                    <div id="fieldsContainer" class="col"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Temperature Section -->
                    <div class="space-related-in border-radius-lg shadow" style="padding: 20px; margin-bottom: 20px;">
                        <h5 class="mt-5" style="font-family: Monospace; text-align: center; color: #007bff;">Set Temperature</h5>
                        <div class="row" style="padding: 10px;">
                            <div class="col">
                                <input type="text" class="form-control" name="max_value" placeholder="Max Temperature" style="border-radius: 8px; padding: 12px 18px;">
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" name="min_value" placeholder="Min Temperature" style="border-radius: 8px; padding: 12px 18px;">
                            </div>
                        </div>
                    </div>

                    <!-- Corrective Actions Section -->
                    <div class="space-related-in border-radius-lg shadow" style="padding: 20px; margin-bottom: 20px;">
                        <h5 class="mt-5" style="font-family: Monospace; text-align: center; color: #007bff;">Corrective Actions</h5>
                        <div class="alert alert-success" style="margin: 30px; padding: 20px; font-size: 16px; border-radius: 8px;">
                            <span class="alert-icon" style="font-size: 20px;">ℹ️</span>
                            <span>The following corrective actions will be shown when a non-compliant value is logged.</span>
                        </div>
                        {% for action in corrective_action %}
                            <label style="font-weight: 600;">
                                <input type="checkbox" id="corrective_action" name="corrective_action" value="{{ action.id }}">
                                {{ action.name }}
                            </label><br>
                        {% endfor %}
                    </div>

                    <!-- Approver Section -->
                    <div class="space-related-in border-radius-lg shadow" style="padding: 20px; margin-bottom: 20px;">
                        <h5 class="mt-5" style="font-family: Monospace; text-align: center; color: #007bff;">Select First Level Approver</h5>
                        <div style="padding: 10px;">
                            <select name="select_verifier" class="form-control" style="border-radius: 8px; padding: 12px 18px;">
                                <option value="line_staff">Line Staff</option>
                                <option value="supervisors">Supervisors</option>
                                <option value="managers">Managers</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-lg btn-block" style="padding: 12px 20px; margin-top: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">Confirm</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    function generateOnField() {
        let num = document.getElementById("numberofusedfor").value;
        let fieldsContainer = document.getElementById("fieldsContainer");
        fieldsContainer.innerHTML = '';
        for (let i = 0; i < num; i++) {
            let fieldDiv = document.createElement("div");
            fieldDiv.classList.add("form-group");
            let label = document.createElement("label");
            label.textContent = `Used for ${i+1}:`;
            let inputField = document.createElement("input");
            inputField.type = "text";
            inputField.name = `used_for_${i+1}`;
            inputField.classList.add("form-control");
            fieldDiv.appendChild(label);
            fieldDiv.appendChild(inputField);
            fieldsContainer.appendChild(fieldDiv);
        }
    }
</script>
{% endblock %}
