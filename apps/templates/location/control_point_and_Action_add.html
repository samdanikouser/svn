{% extends "layouts/base.html" %}

{% block title %}Add Control Point and Corrective Action{% endblock %}

{% block content %}
<!-- Display Messages -->
{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Navigation -->
<div class="d-flex justify-content-between mb-3">
    <a href="javascript:history.back()" class="btn btn-primary btn-sm">Back</a>
    <a href="{% url 'locationlist' %}" style="text-decoration: none; font-size: 16px;" class="btn btn-primary btn-sm">View Locations</a>
</div>

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header card-header-primary">
                <h4 class="card-title mb-0">Add Control Point and Corrective Action for {{ location_name }}</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}

                    <!-- Control Point Form -->
                    <div class="form-group">
                        <label for="id_location">Location</label>
                        {{ control_point_form.location }}
                        {% if control_point_form.errors.location %}
                            <div class="alert alert-danger mt-2">
                                {{ control_point_form.errors.location.as_text|cut:"* " }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_name">Control Point Name</label>
                        {{ control_point_form.name }}
                        {% if control_point_form.errors.name %}
                            <div class="alert alert-danger mt-2">
                                {{ control_point_form.errors.name.as_text|cut:"* " }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_daily_activity">Daily Activity</label>
                        {{ control_point_form.daily_activity }}
                        {% if control_point_form.errors.daily_activity %}
                            <div class="alert alert-danger mt-2">
                                {{ control_point_form.errors.daily_activity.as_text|cut:"* " }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_status">Control Point Status</label>
                        {{ control_point_form.status }}
                        {% if control_point_form.errors.status %}
                            <div class="alert alert-danger mt-2">
                                {{ control_point_form.errors.status.as_text|cut:"* " }}
                            </div>
                        {% endif %}
                    </div>

                    <div id="corrective-actions-container">
                        <div class="corrective-action-form mb-4 p-3 border rounded shadow-sm bg-light">
                            <div class="form-group">
                                <label for="id_name">Corrective Action Name</label>
                                <input type="text" name="corrective_actions[][name]" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="id_status">Action Status</label>
                                <select name="corrective_actions[][status]" class="form-control" required>
                                    <option value="True">Active</option>
                                    <option value="False">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Button to Add More Corrective Actions -->
                    <button type="button" class="btn btn-secondary" id="add-corrective-action">+ Add Corrective Action</button>

                    <div class="text-center mt-3">
                        <button type="submit" class="btn btn-success">Add Control Point and Action</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Hidden Template for New Corrective Action Form -->
<script type="text/template" id="corrective-action-template">
    <div class="corrective-action-form mb-4 p-3 border rounded shadow-sm bg-light">
        <div class="form-group">
            <label for="id_name">Corrective Action Name</label>
            <input type="text" name="corrective_actions[][name]" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="id_status">Action Status</label>
            <select name="corrective_actions[][status]" class="form-control" required>
                <option value="True">Active</option>
                <option value="False">Inactive</option>
            </select>
        </div>
    </div>
</script>

<script>
    document.getElementById('add-corrective-action').addEventListener('click', function() {
        var template = document.getElementById('corrective-action-template').innerHTML;
        var container = document.getElementById('corrective-actions-container');
        container.insertAdjacentHTML('beforeend', template);
    });
</script>

{% endblock %}
